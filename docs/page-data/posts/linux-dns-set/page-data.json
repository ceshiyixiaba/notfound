{"componentChunkName":"component---src-pages-posts-asciidoc-page-attributes-slug-tsx","path":"/posts/linux-dns-set/","result":{"data":{"asciidoc":{"id":"9456667a-abce-5317-a64e-871459136d29","html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Ubuntu 20.04</p>\n</li>\n<li>\n<p>Fedora 35</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>可通过 <code>resolvectl</code> 或者 <code>systemd-resolve</code> 对 DNS 进行配置。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_通过_resolvectl\"><a class=\"anchor\" href=\"#_通过_resolvectl\"></a>通过 resolvectl</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>获取不同接口 DNS:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">resolvectl dns\n# 输出:\n# Global: 192.168.1.254\n# Link 2 (enp2s0):</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>设置 Link 2 的 DNS:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo resolvectl dns 2 119.29.29.29\n\nresolvectl dns\n# 输出:\n# Global:\n# Link 2 (enp2s0): 119.29.29.29</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>重启后失效</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_通过_systemd\"><a class=\"anchor\" href=\"#_通过_systemd\"></a>通过 Systemd</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>查看 DNS 信息:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">systemd-resolve --status</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>设置 Link 2 的 DNS:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo systemd-resolve --interface=2 --set-dns=119.29.29.29</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>重启后失效</p>\n</li>\n</ul>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_设置全局_dns\"><a class=\"anchor\" href=\"#_设置全局_dns\"></a>设置全局 DNS</h3>\n<div class=\"paragraph\">\n<p>编辑文件 <code>/etc/systemd/resolved.conf</code>：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-conf\" data-lang=\"conf\">[Resolve]\nDNS=192.168.1.60\nFallbackDNS=119.29.29.29</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>重启 systemd-resolved，让配置生效</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-text\" data-lang=\"text\">sudo systemctl restart systemd-resolved.service</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>重启后不会失效</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_netplan\"><a class=\"anchor\" href=\"#_netplan\"></a>netplan</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Ubuntu 20.04 desktop 使用 netplan 管理网络。</p>\n</div>\n<div class=\"paragraph\">\n<p>编辑 <code>/etc/netplan/01-network-manager-all.yaml</code>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-yaml\" data-lang=\"yaml\"># Let NetworkManager manage all devices on this system\n# network:\n#   version: 2\n#   renderer: NetworkManager\nnetwork:\n  version: 2\n  ethernets:\n    enp2s0:\n      dhcp4: true\n      nameservers:\n        addresses: [119.29.29.29]</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>先测试配置是否正确，尝试应用配置：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo netplan try</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>测试无误后，应用配置：</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">sudo netplan apply</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\"><a class=\"anchor\" href=\"#_参考\"></a>参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://askubuntu.com/questions/973017/wrong-nameserver-set-by-resolvconf-and-networkmanager\" class=\"bare\">https://askubuntu.com/questions/973017/wrong-nameserver-set-by-resolvconf-and-networkmanager</a></p>\n</li>\n<li>\n<p><a href=\"https://netplan.io/\" class=\"bare\">https://netplan.io/</a></p>\n</li>\n<li>\n<p><a href=\"https://www.tecmint.com/set-static-ip-address-in-ubuntu/\" class=\"bare\">https://www.tecmint.com/set-static-ip-address-in-ubuntu/</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","document":{"title":"Linux 配置 DNS"},"pageAttributes":{"slug":"linux-dns-set","category":"linux"},"revision":{"date":"2021-10-17","number":"1.0"}}},"pageContext":{"id":"9456667a-abce-5317-a64e-871459136d29","pageAttributes__slug":"linux-dns-set","__params":{"pageAttributes__slug":"linux-dns-set"}}},"staticQueryHashes":["3143286284"]}